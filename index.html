<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="CLUnit : Common Lisp Unit Test Framework" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>CLUnit</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/tgutu/clunit">View on GitHub</a>

          <h1 id="project_title">CLUnit</h1>
          <h2 id="project_tagline">Common Lisp Unit Test Framework</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/tgutu/clunit/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/tgutu/clunit/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>CLUnit</h2>

<p>CLUnit is a Common Lisp unit testing framework. It is designed to be easy to use so that you can quickly start testing.</p>

<p>CLUnit provides a rich set of features aimed at improving your unit testing experience:</p>

<ul>
<li>Multiple inheritance for test suites allows you to group tests into hierarchies.</li>
<li>Composes the test results of each test run into a single report.</li>
<li>Allows redefinition of inline functions and macros without having to redefine your tests.</li>
<li>Supports composable test suite fixtures.</li>
<li>Allows for an interactive testing process which gives you access to the test environment.</li>
<li>Provides visual feeback of the unit test progress.</li>
<li>Extensible test reporting. Builtin support for default reporting and <a href="http://en.wikipedia.org/wiki/Test_Anything_Protocol" title="Test Anything Protocol">TAP</a> output.</li>
</ul><h3>Table of Contents</h3>

<ol>
<li><a href='#clunit_1'>Documentation</a></li>
<li><a href='#clunit_2'>Tutorial</a>

<ol>
<li><a href='#clunit_3'>Creating the test hierarchy</a></li>
<li><a href='#clunit_4'>Defining a test</a></li>
<li><a href='#clunit_5'>Running our first test</a></li>
<li><a href='#clunit_6'>Rerunning failed tests</a></li>
<li><a href='#clunit_7'>Changing the report format</a></li>
<li><a href='#clunit_8'>Controlling diagnostic output</a></li>
<li><a href='#clunit_9'>Interactive tests</a></li>
<li><a href='#clunit_10'>Defining and using fixtures</a></li>
<li><a href='#clunit_11'>Short circuiting a unit test</a></li>
<li style='margin-left: -0.5em;'><a href='#clunit_12'>Test dependency</a></li>
</ol>
</li>
</ol><h4 id='clunit_1'>Documentation</h4>

<p>The API documentation can be found <a href="api/clunit.xml" title="CLUnit Documentation">here</a>. If you are interested in the story behind CLUnit you can find it <a href="http://ml.sun.ac.za/2012/11/09/developing-a-unit-test-framework-part-1/" title="Developing a unit test framework">here</a>.</p>

<h4 id='clunit_2'>Tutorial</h4>

<p>For this tutorial we will write a unit test for our hypothetical number crunching library. Our unit test contains four test suites and five test cases. The image below gives a visual representation of our test hierarchy.</p>

<p><img src="api/images/example-test-suite.png" style="width: 290px; height: 480px; position: static; display: block; margin-left: auto; margin-right: auto; text-align: center;" alt="Test suite heirarchy"/></p>

<h5 id='clunit_3'>Creating the test hierarchy</h5>

<p>To create the test suite hierarchy shown in the image we use the following code.</p>

<div class="highlight"><pre><span class="c1">;; Test suite for all number operation tests.</span>
<span class="p">(</span><span class="nv">defsuite</span> <span class="nv">NumberSuite</span> <span class="p">())</span>

<span class="c1">;; Test suite for floating point operations</span>
<span class="p">(</span><span class="nv">defsuite</span> <span class="nv">FloatSuite</span> <span class="p">(</span><span class="nv">NumberSuite</span><span class="p">))</span>

<span class="c1">;; Test suite for integer operations.</span>
<span class="p">(</span><span class="nv">defsuite</span> <span class="nv">IntegerSuite</span> <span class="p">(</span><span class="nv">NumberSuite</span><span class="p">))</span>

<span class="c1">; Test suite for boolean operations on numbers.</span>
<span class="p">(</span><span class="nv">defsuite</span> <span class="nv">BooleanSuite</span> <span class="p">(</span><span class="nv">FloatSuite</span> <span class="nv">IntegerSuite</span><span class="p">))</span>
</pre></div>

<p><br></p>

<h5 id='clunit_4'>Defining a test</h5>

<p>Next we define two test cases for our <code>FloatSuite</code> and <code>IntegerSuite</code> test suites. Each test contains two assertion forms.</p>

<p><code>ASSERT-TRUE</code> considers the assertion a pass if the expression supplied to it returns true and <code>(ASSERT-EQUAL value expression)</code> considers the assertion to have passed if <code>(EQUAL value expression)</code> returns true.</p>

<div class="highlight"><pre><span class="c1">;; Define a test called TEST-INT1</span>
<span class="p">(</span><span class="nv">deftest</span> <span class="nv">test-int1</span> <span class="p">(</span><span class="nv">IntegerSuite</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">assert-true</span>  <span class="p">(</span><span class="nb">=</span> <span class="mi">1</span> <span class="mi">-1</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">assert-equal</span> <span class="mi">4</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)))</span>

<span class="c1">;; Define a test called TEST-FLOAT1</span>
<span class="p">(</span><span class="nv">deftest</span> <span class="nv">test-float1</span> <span class="p">(</span><span class="nv">FloatSuite</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">assert-true</span> <span class="p">(</span><span class="nb">=</span> <span class="mf">1.0</span> <span class="mf">-1.0</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">assert-equal</span> <span class="mf">4.0</span> <span class="p">(</span><span class="nb">+</span> <span class="mf">2.0</span> <span class="mf">2.0</span><span class="p">)))</span>
</pre></div>

<p><br></p>

<h5 id='clunit_5'>Running our first test</h5>

<p>To run an individual test you use the form <code>(RUN-TEST 'test-name)</code>, however we are interested in running the entire test suite so we shall use the form  <code>(RUN-SUITE 'test-name)</code>.</p>

<div class="highlight"><pre><span class="p">(</span><span class="nv">run-suite</span> <span class="ss">'NumberSuite</span><span class="p">)</span>

<span class="nv">PROGRESS:</span>
<span class="nv">=========</span>

    <span class="nv">NUMBERSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>

        <span class="nv">INTEGERSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>
            <span class="nv">TEST-INT1:</span> <span class="nv">F.</span>

            <span class="nv">BOOLEANSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>

        <span class="nv">FLOATSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>
            <span class="nv">TEST-FLOAT1:</span> <span class="nv">F.</span>

            <span class="nv">BOOLEANSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>
<span class="nv">DETAILS:</span>
<span class="nv">=========</span>

    <span class="nv">NUMBERSUITE</span> <span class="nv">-&gt;</span> <span class="nv">INTEGERSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>
        <span class="nv">TEST-INT1:</span> <span class="nv">Expression:</span> <span class="p">(</span><span class="nb">=</span> <span class="mi">1</span> <span class="mi">-1</span><span class="p">)</span>
                   <span class="nv">Expected:</span> <span class="no">T</span>
                   <span class="nv">Returned:</span> <span class="no">NIL</span>

    <span class="nv">NUMBERSUITE</span> <span class="nv">-&gt;</span> <span class="nv">FLOATSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>
        <span class="nv">TEST-FLOAT1:</span> <span class="nv">Expression:</span> <span class="p">(</span><span class="nb">=</span> <span class="mf">1.0</span> <span class="mf">-1.0</span><span class="p">)</span>
                     <span class="nv">Expected:</span> <span class="no">T</span>
                     <span class="nv">Returned:</span> <span class="no">NIL</span>
<span class="nv">SUMMARY:</span>
<span class="nv">========</span>
    <span class="nv">Tested</span> <span class="mi">4</span> <span class="nv">assertions.</span>
        <span class="nv">Passed:</span> <span class="m">2/4</span> <span class="p">(</span> <span class="nv">50.0%</span><span class="p">)</span>
        <span class="nv">Failed:</span> <span class="m">2/4</span> <span class="p">(</span> <span class="nv">50.0%</span><span class="p">)</span>
        <span class="nv">Errors:</span> <span class="m">0/4</span> <span class="p">(</span>  <span class="nv">0.0%</span><span class="p">)</span>
</pre></div>

<p>The functions <code>RUN-SUITE</code> and <code>RUN-TEST</code> by default print out the test progress as they execute. The function <code>RUN-SUITE</code> first executes the tests referred to by the test suite argument. After executing the test cases, it then executes the child test suites. This process is repeated recursively until all the test cases and test suites in the hierarchy have been executed.</p>

<p>During the test progress, the names of test suites and test cases are printed using a visual format that shows how the hierarchy is nested. Each assertion in a test case prints either <code>.</code> for a pass or <code>F</code> for a failure. An <code>E</code> is printed when an error occurs in the test, when an <code>E</code> is seen it means there is a serious problem in your code and the rest of the test case is skipped.</p>

<p>The progress report can be switched off by setting the <code>:report-progress</code> keyword argument to <code>NIL</code> for example:</p>

<div class="highlight"><pre><span class="p">(</span><span class="nv">run-suite</span> <span class="ss">'NumberSuite</span> <span class="ss">:report-progress</span> <span class="no">nil</span><span class="p">)</span>
<span class="nv">DETAILS:</span>
<span class="nv">=========</span>

    <span class="nv">NUMBERSUITE</span> <span class="nv">-&gt;</span> <span class="nv">INTEGERSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>
        <span class="nv">TEST-INT1:</span> <span class="nv">Expression:</span> <span class="p">(</span><span class="nb">=</span> <span class="mi">1</span> <span class="mi">-1</span><span class="p">)</span>
                   <span class="nv">Expected:</span> <span class="no">T</span>
                   <span class="nv">Returned:</span> <span class="no">NIL</span>

    <span class="nv">NUMBERSUITE</span> <span class="nv">-&gt;</span> <span class="nv">FLOATSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>
        <span class="nv">TEST-FLOAT1:</span> <span class="nv">Expression:</span> <span class="p">(</span><span class="nb">=</span> <span class="mf">1.0</span> <span class="mf">-1.0</span><span class="p">)</span>
                     <span class="nv">Expected:</span> <span class="no">T</span>
                     <span class="nv">Returned:</span> <span class="no">NIL</span>
<span class="nv">SUMMARY:</span>
<span class="nv">========</span>
    <span class="nv">Tested</span> <span class="mi">4</span> <span class="nv">assertions.</span>
        <span class="nv">Passed:</span> <span class="m">2/4</span> <span class="p">(</span> <span class="nv">50.0%</span><span class="p">)</span>
        <span class="nv">Failed:</span> <span class="m">2/4</span> <span class="p">(</span> <span class="nv">50.0%</span><span class="p">)</span>
        <span class="nv">Errors:</span> <span class="m">0/4</span> <span class="p">(</span>  <span class="nv">0.0%</span><span class="p">)</span>
</pre></div>

<p><br></p>

<h5 id='clunit_6'>Rerunning failed tests</h5>

<p>CLUnit provides a convenient function <code>(RERUN-FAILED-TESTS)</code> for rerunning only the tests that failed the last time. When the failed tests are fixed, you do the normal run to make sure all tests pass.
<br></p>

<h5 id='clunit_7'>Changing the report format</h5>

<p>The functions <code>RUN-SUITE</code> and <code>RUN-TEST</code> return a <code>CLUNIT-REPORT</code> object, the default <code>PRINT-OBJECT</code> method prints the aggregated details of the unit test failures and a test summary. </p>

<p>The variable <code>clunit:*clunit-report-format*</code> controls the output format of the unit test results. Possible values are <code>:default</code>, <code>:tap</code> or <code>NIL</code>. The value <code>:tap</code> sets the reporting to <a href="http://en.wikipedia.org/wiki/Test_Anything_Protocol" title="Test Anything Protocol">TAP</a> output.</p>

<div class="highlight"><pre><span class="p">(</span><span class="nb">setf</span> <span class="nv">clunit:*clunit-report-format*</span> <span class="ss">:tap</span><span class="p">)</span>
<span class="p">(</span><span class="nv">run-suite</span> <span class="ss">'NumberSuite</span> <span class="ss">:report-progress</span> <span class="no">nil</span><span class="p">)</span>
<span class="nv">TAP</span> <span class="nv">version</span> <span class="mi">13</span>
<span class="nv">1..4</span>
<span class="nb">not</span> <span class="nv">ok</span> <span class="mi">1</span>
    <span class="err">#</span>  <span class="nv">Suite:</span> <span class="nv">NUMBERSUITE</span> <span class="nv">-&gt;</span> <span class="nv">INTEGERSUITE</span>
    <span class="err">#</span>  <span class="nv">Test:</span> <span class="nv">TEST-INT1</span>
    <span class="err">#</span>  <span class="nv">Expression:</span> <span class="p">(</span><span class="nb">=</span> <span class="mi">1</span> <span class="mi">-1</span><span class="p">)</span>
    <span class="err">#</span>  <span class="nv">Expected:</span> <span class="no">T</span>
    <span class="err">#</span>  <span class="nv">Returned:</span> <span class="no">NIL</span>
<span class="nv">ok</span> <span class="mi">2</span>
<span class="nb">not</span> <span class="nv">ok</span> <span class="mi">3</span>
    <span class="err">#</span>  <span class="nv">Suite:</span> <span class="nv">NUMBERSUITE</span> <span class="nv">-&gt;</span> <span class="nv">FLOATSUITE</span>
    <span class="err">#</span>  <span class="nv">Test:</span> <span class="nv">TEST-FLOAT1</span>
    <span class="err">#</span>  <span class="nv">Expression:</span> <span class="p">(</span><span class="nb">=</span> <span class="mf">1.0</span> <span class="mf">-1.0</span><span class="p">)</span>
    <span class="err">#</span>  <span class="nv">Expected:</span> <span class="no">T</span>
    <span class="err">#</span>  <span class="nv">Returned:</span> <span class="no">NIL</span>
<span class="nv">ok</span> <span class="mi">4</span>
</pre></div>

<p><br></p>

<h5 id='clunit_8'>Controlling diagnostic output</h5>

<p>Apart from the mandatory arguments, the assertion forms accept additional arguments that will be printed if an error occurs. An assertion macro call then takes the the following form:</p>

<div class="highlight"><pre><span class="p">(</span><span class="nv">ASSERT-TRUE</span> <span class="nv">expression</span> <span class="nv">[form1]</span> <span class="nv">[form2]</span> <span class="o">...</span> <span class="nv">[formN]</span><span class="p">)</span>
</pre></div>

<p>If the assertion fails the form and its value is printed. However, if the form is a string only the value is printed so this can be used to insert comments into the diagnostic output.</p>

<div class="highlight"><pre><span class="p">(</span><span class="nv">deftest</span> <span class="nv">test-suiteless</span> <span class="p">()</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">a</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="mi">3</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">assert-true</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="s">"This assertion is meant to fail."</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="p">)))</span>

<span class="p">(</span><span class="nv">run-test</span> <span class="ss">'test-suiteless</span> <span class="ss">:report-progress</span> <span class="no">nil</span><span class="p">)</span>

<span class="nv">DETAILS:</span>
<span class="nv">=========</span>
    <span class="nv">TEST-SUITELESS:</span> <span class="nv">Expression:</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span><span class="p">)</span>
                    <span class="nv">Expected:</span> <span class="no">T</span>
                    <span class="nv">Returned:</span> <span class="no">NIL</span>
                    <span class="nv">This</span> <span class="nv">assertion</span> <span class="nv">is</span> <span class="nv">meant</span> <span class="nv">to</span> <span class="nv">fail.</span>
                    <span class="nv">A</span> <span class="nv">=&gt;</span> <span class="mi">1</span>
                    <span class="nv">B</span> <span class="nv">=&gt;</span> <span class="mi">2</span>
                    <span class="nv">C</span> <span class="nv">=&gt;</span> <span class="mi">3</span>
<span class="nv">SUMMARY:</span>
<span class="nv">========</span>
    <span class="nv">Tested</span> <span class="mi">1</span> <span class="nv">assertion.</span>
        <span class="nv">Passed:</span> <span class="m">0/1</span> <span class="p">(</span>  <span class="nv">0.0%</span><span class="p">)</span>
        <span class="nv">Failed:</span> <span class="m">1/1</span> <span class="p">(</span><span class="nv">100.0%</span><span class="p">)</span>
        <span class="nv">Errors:</span> <span class="m">0/1</span> <span class="p">(</span>  <span class="nv">0.0%</span><span class="p">)</span>
</pre></div>

<p><br></p>

<h5 id='clunit_9'>Interactive tests</h5>

<p>The functions <code>RUN-SUITE</code> and <code>RUN-TEST</code> accept another keyword argument called <code>:use-debugger</code>. If this argument is set to true, the unit test will fall into the debugger if an assesrtion fails.</p>

<div class="highlight"><pre><span class="p">(</span><span class="nv">run-suite</span> <span class="ss">'NumberSuite</span> <span class="ss">:report-progress</span> <span class="no">nil</span> <span class="ss">:use-debugger</span> <span class="no">t</span><span class="p">)</span>

<span class="nv">Debugger</span> <span class="nv">invoked</span> <span class="nv">on</span> <span class="nv">a</span> <span class="nv">CLUNIT::ASSERTION-CONDITION:</span>
  <span class="nv">TEST-INT1:</span> <span class="nv">Expression:</span> <span class="p">(</span><span class="nb">=</span> <span class="mi">1</span> <span class="mi">-1</span><span class="p">)</span>
             <span class="nv">Expected:</span> <span class="no">T</span>
             <span class="nv">Returned:</span> <span class="no">NIL</span>

<span class="nv">Type</span> <span class="nv">HELP</span> <span class="nv">for</span> <span class="nv">debugger</span> <span class="nv">help,</span> <span class="nb">or</span> <span class="p">(</span><span class="nv">SB-EXT:QUIT</span><span class="p">)</span> <span class="nv">to</span> <span class="nv">exit</span> <span class="nv">from</span> <span class="nv">SBCL.</span>

<span class="nv">restarts</span> <span class="p">(</span><span class="nv">invokable</span> <span class="nv">by</span> <span class="nc">number</span> <span class="nb">or</span> <span class="nv">by</span> <span class="nv">possibly-abbreviated</span> <span class="nv">name</span><span class="p">)</span><span class="err">:</span>
  <span class="nv">0:</span> <span class="nv">[CONTINUE</span>                  <span class="nv">]</span> <span class="nv">Continue</span> <span class="nv">with</span> <span class="nv">TEST-INT1</span> <span class="nv">test.</span>
  <span class="nv">1:</span> <span class="nv">[CONTINUE-WITHOUT-DEBUGGING]</span> <span class="nv">Continue</span> <span class="nv">unit</span> <span class="nv">test</span> <span class="nv">without</span> <span class="nv">interactive</span> <span class="nv">debugging.</span>
  <span class="nv">2:</span> <span class="nv">[SKIP-ASSERTION</span>            <span class="nv">]</span> <span class="nv">Skip</span> <span class="nv">assertion</span> <span class="nv">in</span> <span class="nv">test</span> <span class="nv">TEST-INT1.</span>
  <span class="nv">3:</span>                              <span class="nv">Continue</span> <span class="nv">unit</span> <span class="nv">test</span> <span class="nv">without</span> <span class="nv">interactive</span> <span class="nv">debugging.</span>
  <span class="nv">4:</span> <span class="nv">[SKIP-TEST</span>                 <span class="nv">]</span> <span class="nv">Skip</span> <span class="nv">test</span> <span class="nv">TEST-INT1.</span>
  <span class="nv">5:</span> <span class="nv">[SKIP-SUITE</span>                <span class="nv">]</span> <span class="nv">Skip</span> <span class="nv">test</span> <span class="nv">suite</span> <span class="nv">INTEGERSUITE.</span>
  <span class="nv">6:</span>                              <span class="nv">Skip</span> <span class="nv">test</span> <span class="nv">suite</span> <span class="nv">NUMBERSUITE.</span>
  <span class="nv">7:</span> <span class="nv">[CANCEL-UNIT-TEST</span>          <span class="nv">]</span> <span class="nv">Cancel</span> <span class="nv">unit</span> <span class="nv">test</span> <span class="nv">execution.</span>
  <span class="nv">8:</span> <span class="nv">[ABORT</span>                     <span class="nv">]</span> <span class="nv">Exit</span> <span class="nv">debugger,</span> <span class="nv">returning</span> <span class="nv">to</span> <span class="nv">top</span> <span class="nv">level.</span>
</pre></div>

<p><br></p>

<h5 id='clunit_10'>Defining and using fixtures</h5>

<p>Fixtures are used in unit tests to setup a consistent context/enviroment in which tests can be executed so that results are reproducible. CLUnit allows you to define fixtures for each test suite.</p>

<p>The form <code>(deffixture suite (plug) . body)</code> defines a code template that is wrapped around the code of each test case and test suite that are executed by that test suite at runtime. The test case body is plugged into the template at the position identified by <code>PLUG</code>. Fixtures are expanded at runtime, so the fixture that will wrap around a test depends on the test suite call stack. </p>

<div class="highlight"><pre><span class="c1">;; Fixture Definitions</span>
<span class="p">(</span><span class="nv">deffixture</span> <span class="nv">IntegerSuite</span> <span class="p">(</span><span class="nv">@body</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">x</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="mi">2</span><span class="p">))</span>
        <span class="nv">@body</span><span class="p">))</span>

<span class="p">(</span><span class="nv">deffixture</span> <span class="nv">FloatSuite</span> <span class="p">(</span><span class="nv">@body</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">x</span> <span class="mf">0.0</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="mf">1.0</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="mf">2.0</span><span class="p">))</span>
        <span class="nv">@body</span><span class="p">)))</span>

<span class="c1">;; Test Case Definition</span>
<span class="p">(</span><span class="nv">deftest</span> <span class="nv">test-bool1</span> <span class="p">(</span><span class="nv">BooleanSuite</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">assert-true</span>  <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">assert-true</span>  <span class="p">(</span><span class="nb">=</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">abracadabra</span><span class="p">)</span>

<span class="p">(</span><span class="nv">run-suite</span> <span class="ss">'NumberSuite</span><span class="p">)</span>

<span class="nv">PROGRESS:</span>
<span class="nv">=========</span>

    <span class="nv">NUMBERSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>

        <span class="nv">INTEGERSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>

            <span class="nv">BOOLEANSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>
                <span class="nv">TEST-BOOL1:</span> <span class="o">.</span><span class="nv">FE</span>

        <span class="nv">FLOATSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>

            <span class="nv">BOOLEANSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>
                <span class="nv">TEST-BOOL1:</span> <span class="o">.</span><span class="nv">FE</span>
<span class="nv">DETAILS:</span>
<span class="nv">=========</span>

    <span class="nv">NUMBERSUITE</span> <span class="nv">-&gt;</span> <span class="nv">INTEGERSUITE</span> <span class="nv">-&gt;</span> <span class="nv">BOOLEANSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>
        <span class="nv">TEST-BOOL1:</span> <span class="nv">Expression:</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">X</span> <span class="nv">Y</span> <span class="nv">Z</span><span class="p">)</span>
                    <span class="nv">Expected:</span> <span class="no">T</span>
                    <span class="nv">Returned:</span> <span class="no">NIL</span>
                    <span class="nv">X</span> <span class="nv">=&gt;</span> <span class="mi">0</span>
                    <span class="nv">Y</span> <span class="nv">=&gt;</span> <span class="mi">1</span>
                    <span class="nv">Z</span> <span class="nv">=&gt;</span> <span class="mi">2</span>
        <span class="nv">TEST-BOOL1:</span> <span class="nv">The</span> <span class="k">function</span> <span class="nv">COMMON-LISP-USER::ABRACADABRA</span> <span class="nv">is</span> <span class="nv">undefined.</span>

    <span class="nv">NUMBERSUITE</span> <span class="nv">-&gt;</span> <span class="nv">FLOATSUITE</span> <span class="nv">-&gt;</span> <span class="nv">BOOLEANSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>
        <span class="nv">TEST-BOOL1:</span> <span class="nv">Expression:</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">X</span> <span class="nv">Y</span> <span class="nv">Z</span><span class="p">)</span>
                    <span class="nv">Expected:</span> <span class="no">T</span>
                    <span class="nv">Returned:</span> <span class="no">NIL</span>
                    <span class="nv">X</span> <span class="nv">=&gt;</span> <span class="mf">0.0</span>
                    <span class="nv">Y</span> <span class="nv">=&gt;</span> <span class="mf">1.0</span>
                    <span class="nv">Z</span> <span class="nv">=&gt;</span> <span class="mf">2.0</span>
        <span class="nv">TEST-BOOL1:</span> <span class="nv">The</span> <span class="k">function</span> <span class="nv">COMMON-LISP-USER::ABRACADABRA</span> <span class="nv">is</span> <span class="nv">undefined.</span>

<span class="nv">SUMMARY:</span>
<span class="nv">========</span>
    <span class="nv">Tested</span> <span class="mi">6</span> <span class="nv">assertions.</span>
        <span class="nv">Passed:</span> <span class="m">2/6</span> <span class="p">(</span> <span class="nv">33.3%</span><span class="p">)</span>
        <span class="nv">Failed:</span> <span class="m">2/6</span> <span class="p">(</span> <span class="nv">33.3%</span><span class="p">)</span>
        <span class="nv">Errors:</span> <span class="m">2/6</span> <span class="p">(</span> <span class="nv">33.3%</span><span class="p">)</span>
</pre></div>

<p><br></p>

<h5 id='clunit_11'>Short circuiting a unit test</h5>

<p>CLUnit provides an easy way of short circuiting a unit test. The functions <code>RUN-SUITE</code> and <code>RUN-TEST</code> accept another keyword argument called <code>:stop-on-fail</code>. If this argument is set to true, the rest of the unit test is cancelled when any assertion fails or an error occurs.</p>

<div class="highlight"><pre><span class="p">(</span><span class="nv">run-suite</span> <span class="ss">'NumberSuite</span> <span class="ss">:stop-on-fail</span> <span class="no">t</span><span class="p">)</span>
<span class="nv">PROGRESS:</span>
<span class="nv">=========</span>

    <span class="nv">NUMBERSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>

        <span class="nv">INTEGERSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>
            <span class="nv">TEST-INT1:</span> <span class="nv">F</span>
<span class="nv">DETAILS:</span>
<span class="nv">=========</span>

    <span class="nv">NUMBERSUITE</span> <span class="nv">-&gt;</span> <span class="nv">INTEGERSUITE:</span> <span class="p">(</span><span class="nv">Test</span> <span class="nv">Suite</span><span class="p">)</span>
        <span class="nv">TEST-INT1:</span> <span class="nv">Expression:</span> <span class="p">(</span><span class="nb">=</span> <span class="mi">1</span> <span class="mi">-1</span><span class="p">)</span>
                   <span class="nv">Expected:</span> <span class="no">T</span>
                   <span class="nv">Returned:</span> <span class="no">NIL</span>
<span class="nv">SUMMARY:</span>
<span class="nv">========</span>
    <span class="nv">Tested</span> <span class="mi">1</span> <span class="nv">assertion.</span>
        <span class="nv">Passed:</span> <span class="m">0/1</span> <span class="p">(</span>  <span class="nv">0.0%</span><span class="p">)</span>
        <span class="nv">Failed:</span> <span class="m">1/1</span> <span class="p">(</span><span class="nv">100.0%</span><span class="p">)</span>
        <span class="nv">Errors:</span> <span class="m">0/1</span> <span class="p">(</span>  <span class="nv">0.0%</span><span class="p">)</span>
</pre></div>

<h5 id='clunit_12'>Test dependency</h5>

<p>Since the execution of tests is unordered, what we need is a way of specifying that one test depends on another test passing. CLUnit provides a way of doing this via the <code>DEFTEST</code> macro.</p>

<div class="highlight"><pre><span class="c1">;; Define a test case not associated with any test suite</span>
<span class="c1">;; and with no dependencies.</span>
<span class="p">(</span><span class="nv">deftest</span> <span class="nv">name</span> <span class="p">()</span> <span class="o">.</span> <span class="nv">body</span><span class="p">)</span>

<span class="c1">;; Define a test case associated with test suites: suite1 ... suiteN.</span>
<span class="p">(</span><span class="nv">deftest</span> <span class="nv">name</span> <span class="p">(</span><span class="nv">suite1</span> <span class="nv">suite2</span> <span class="o">...</span> <span class="nv">suiteN</span><span class="p">)</span> <span class="o">.</span> <span class="nv">body</span><span class="p">)</span>

<span class="c1">;; Define a test case associated with test suites: suite1 ... suiteN</span>
<span class="c1">;; that depends on tests: test1 ... testN.</span>
<span class="p">(</span><span class="nv">deftest</span> <span class="nv">name</span> <span class="p">((</span><span class="nv">suite1</span> <span class="nv">suite2</span> <span class="o">...</span> <span class="nv">suiteN</span><span class="p">)</span> <span class="p">(</span><span class="nv">test1</span> <span class="nv">test2</span> <span class="o">...</span> <span class="nv">testN</span><span class="p">))</span> <span class="o">.</span> <span class="nv">body</span><span class="p">)</span> 
</pre></div>

<p>A test case with dependencies will be queued until all the test cases it depends on have been run. If all the test cases pass the queued test is executed otherwise its skipped.</p>

<h5>Thats all there is to it, so happy hacking!!!</h5>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">CLUnit maintained by <a href="https://github.com/tgutu">tgutu</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
